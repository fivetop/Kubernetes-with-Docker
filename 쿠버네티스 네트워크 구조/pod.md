## 쿠버네티스 네트워크 구조 1. pod

### 1. pod란?
- 쿠버네티스에서 다루는 애플리케이션의 최소 단위
- 1개 이상의 컨테이너를 구성하고 동일한 컴퓨팅 리소스, 네트워크를 공유한다.

### 2. 컨테이너 네트워크
- ![132451435-c03e71e8-b619-460b-8b7a-105ccc9cd17f](https://user-images.githubusercontent.com/62214428/222886740-0b515f70-a147-4bb2-9c2d-ce0146e28762.png)
```
기본적으로 도커 컨테이너는 개별 사설 ip를 부여받는다.
따라서 외부 host에서 컨테이너로의 접근은 다음 순서로 동작하는데
```

```
1. napt : host 포트와 매핑된 사서 ip:port 정보를 반환한다.
  - 이제 접근하고자하는 대상 컨테이너 ip:port 정보를 알고있다.
  
2. docker0 : 네트워크 브릿지로 생성된 컨테이너는 브릿지에 개방되어있다.
  - 접근 대상 컨테이너 ip:port 정보 바탕으로 특정 컨테이너에 접근할 수 있게 해주는 역할을 수행한다.
  
3. veth0 : 컨테이너로의 네트워크 접근(in / out)을 수행한다.
  - 하나의 nic로 nic는 시스템마다 갖는 네트워크 연결 장치
```

### 3. 동일 파드의 컨테이너들은 네트워크를 공유한다?
```
쿠버네티스의 파드내 컨테이너들은 네트워크 스택을 공유한다.
즉 여러 컨테이너가 같은 nic(veth0)를 공유한다.

따라서 같은 172.17.0.2로 두 컨테이너 모두로 접근할 수 있다.
그러나 포트번호로 컨테이너를 나눈다.

동일 파드내 컨테이너는 네트워크 스택(같은 nic인 vethX)를 공유하기 때문에 서로에게 접근할 수 있다.(포트번호로)
```
- ![01_03](https://user-images.githubusercontent.com/62214428/222888414-8b8f4013-dd07-4dce-9c69-ed7d80866b37.png)
```
참고로 deployment로 n개 파드를 replica로 다룰 수 있는데
이때 각 파드는 서로 다른 ip에 의해 동작하기때문에 같은 포트번호를 사용할 수 있다.
```
### 4. 파드가 네트워크를 공유한다고 전체 시스템을 이룰 순 없다.
- 우리는 여러개의 노드(host)를 배치하는데 파드가 네트워크를 공유한다고해서 서로 다른 호스트간 파드가 통신할 순 없다. 그래서 service가 필요하다.
```
아래 그림은 service가 없이 하나의 라우터에 연결된 n개의 host를 보여주는데
```
- ![01_06](https://user-images.githubusercontent.com/62214428/222890166-8e34d860-bafb-4583-92c4-723c85eb47d0.png)
```
여기서 문제점!!!!

서로 다른 노드는 서로의 ip를 알 수 있는가?
- 모른다. 그렇기 때문에 서로간의 통신이 불가능하다.
```
```
쿠버네티스 네트워크는 라우팅 테이블을 통해 이를 해결한다.!
```
- ![01_07](https://user-images.githubusercontent.com/62214428/222890525-b5e07beb-b9b1-49b1-a66b-eca1e94cc8ae.png)


### 그런데
```
여기에는 문제점이 있다.
파드는 유동적이다.
그래서 유동적인 파드에 고정적인 연결을 지원해주는 무언가가 필요하다..

service
```
